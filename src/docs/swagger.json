{
  "openapi": "3.0.3",
  "info": {
    "title": "Rick & Morty Characters API",
    "description": "## üöÄ API GraphQL para b√∫squeda de personajes de Rick & Morty\n\nEsta API permite buscar y consultar personajes de la serie Rick & Morty con sistema de cach√© en Redis para optimizar el rendimiento.\n\n### üîó Enlaces √ötiles\n- [Apollo GraphQL Playground](/graphql) - Interfaz interactiva para probar queries\n- [Repositorio en GitHub](https://github.com/ddpeream/test-backend-blossom)\n- [API Rick & Morty Original](https://rickandmortyapi.com/)\n\n---\n\n## üìä Tecnolog√≠as Utilizadas\n\n| Tecnolog√≠a | Uso |\n|------------|-----|\n| Node.js + Express | Servidor web |\n| Apollo Server | GraphQL |\n| PostgreSQL (Supabase) | Base de datos |\n| Redis | Sistema de cach√© |\n| Sequelize | ORM |\n| TypeScript | Tipado est√°tico |\n\n---\n\n## üîç API GraphQL\n\nLa API principal es **GraphQL** y est√° disponible en `POST /graphql`.\n\n### Queries Disponibles\n\n#### 1. Obtener todos los personajes\n```graphql\nquery {\n  characters {\n    id\n    name\n    status\n    species\n    gender\n    origin\n    image\n  }\n}\n```\n\n#### 2. Obtener personaje por ID\n```graphql\nquery {\n  character(id: 1) {\n    id\n    name\n    status\n    species\n    gender\n    origin\n    image\n  }\n}\n```\n\n#### 3. Buscar con filtros\n```graphql\nquery {\n  searchCharacters(filters: {\n    name: \"Rick\"\n    status: \"Alive\"\n    species: \"Human\"\n    gender: \"Male\"\n  }) {\n    id\n    name\n    status\n    species\n  }\n}\n```\n\n#### 4. Contar personajes\n```graphql\nquery {\n  characterCount\n}\n```\n\n### Mutations Disponibles\n\n#### Sincronizar personajes desde API externa\n```graphql\nmutation {\n  syncCharacters {\n    success\n    message\n    count\n  }\n}\n```\n\n---\n\n## ‚ö° Sistema de Cach√©\n\n- **TTL**: 5 minutos (300 segundos)\n- **Estrategia**: Cache-aside con invalidaci√≥n autom√°tica\n- **Mejora de rendimiento**: ~100x m√°s r√°pido en cache hits\n\n---\n\n## üîÑ Cron Job\n\nEl sistema sincroniza autom√°ticamente cada **12 horas** con la API de Rick & Morty.",
    "version": "1.0.0",
    "contact": {
      "name": "Deimar Perea Moreno",
      "url": "https://github.com/ddpeream",
      "email": "ddpeream@github.com"
    },
    "license": {
      "name": "ISC",
      "url": "https://opensource.org/licenses/ISC"
    }
  },
  "externalDocs": {
    "description": "Documentaci√≥n completa en GitHub",
    "url": "https://github.com/ddpeream/test-backend-blossom#readme"
  },
  "servers": [
    {
      "url": "http://localhost:4000",
      "description": "üîß Servidor de Desarrollo"
    }
  ],
  "tags": [
    {
      "name": "Health",
      "description": "Endpoints de monitoreo y estado del servidor"
    },
    {
      "name": "GraphQL",
      "description": "API GraphQL para consulta de personajes"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health Check",
        "description": "Verifica el estado del servidor, conexi√≥n a Redis y estado del cron job.\n\nEste endpoint es √∫til para:\n- Monitoreo de la aplicaci√≥n\n- Verificar que todos los servicios est√°n funcionando\n- Balanceadores de carga",
        "operationId": "healthCheck",
        "responses": {
          "200": {
            "description": "Servidor funcionando correctamente",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                },
                "examples": {
                  "healthy": {
                    "summary": "Todos los servicios activos",
                    "value": {
                      "status": "OK",
                      "message": "Server is running üöÄ",
                      "redis": "connected",
                      "cron": "running"
                    }
                  },
                  "redis_down": {
                    "summary": "Redis desconectado",
                    "value": {
                      "status": "OK",
                      "message": "Server is running üöÄ",
                      "redis": "disconnected",
                      "cron": "running"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/graphql": {
      "get": {
        "tags": ["GraphQL"],
        "summary": "Apollo Playground",
        "description": "Accede al Apollo GraphQL Playground para probar queries de forma interactiva.\n\n**Nota:** Este endpoint abre la interfaz visual de Apollo Studio.",
        "operationId": "graphqlPlayground",
        "responses": {
          "200": {
            "description": "Apollo Playground HTML"
          }
        }
      },
      "post": {
        "tags": ["GraphQL"],
        "summary": "Ejecutar Query/Mutation GraphQL",
        "description": "Endpoint principal para ejecutar operaciones GraphQL.\n\n## Queries Disponibles\n\n| Query | Descripci√≥n | Par√°metros |\n|-------|-------------|------------|\n| `characters` | Lista todos los personajes | - |\n| `character(id)` | Obtiene un personaje por ID | `id: Int!` |\n| `searchCharacters(filters)` | Busca con filtros | `filters: CharacterFilterInput` |\n| `characterCount` | Cuenta total de personajes | - |\n\n## Mutations Disponibles\n\n| Mutation | Descripci√≥n |\n|----------|-------------|\n| `syncCharacters` | Sincroniza 15 personajes desde la API externa |\n\n## Filtros de B√∫squeda\n\n| Filtro | Tipo | Valores Ejemplo |\n|--------|------|------------------|\n| `name` | String | \"Rick\", \"Morty\" |\n| `status` | String | \"Alive\", \"Dead\", \"unknown\" |\n| `species` | String | \"Human\", \"Alien\" |\n| `gender` | String | \"Male\", \"Female\", \"Genderless\", \"unknown\" |\n| `origin` | String | \"Earth (C-137)\" |",
        "operationId": "graphqlQuery",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GraphQLRequest"
              },
              "examples": {
                "getAllCharacters": {
                  "summary": "üìã Obtener todos los personajes",
                  "description": "Retorna la lista completa de personajes en la base de datos",
                  "value": {
                    "query": "query GetAllCharacters {\n  characters {\n    id\n    name\n    status\n    species\n    gender\n    origin\n    image\n  }\n}"
                  }
                },
                "getCharacterById": {
                  "summary": "üîç Obtener personaje por ID",
                  "description": "Busca un personaje espec√≠fico por su ID",
                  "value": {
                    "query": "query GetCharacter($id: Int!) {\n  character(id: $id) {\n    id\n    name\n    status\n    species\n    gender\n    origin\n    image\n    createdAt\n    updatedAt\n  }\n}",
                    "variables": {
                      "id": 1
                    }
                  }
                },
                "searchByName": {
                  "summary": "üîé Buscar por nombre",
                  "description": "Busca personajes cuyo nombre contenga 'Rick'",
                  "value": {
                    "query": "query SearchByName {\n  searchCharacters(filters: { name: \"Rick\" }) {\n    id\n    name\n    status\n    species\n  }\n}"
                  }
                },
                "searchWithMultipleFilters": {
                  "summary": "üéØ B√∫squeda con m√∫ltiples filtros",
                  "description": "Busca humanos vivos de g√©nero masculino",
                  "value": {
                    "query": "query SearchFiltered($filters: CharacterFilterInput) {\n  searchCharacters(filters: $filters) {\n    id\n    name\n    status\n    species\n    gender\n    origin\n  }\n}",
                    "variables": {
                      "filters": {
                        "status": "Alive",
                        "species": "Human",
                        "gender": "Male"
                      }
                    }
                  }
                },
                "getCharacterCount": {
                  "summary": "üìä Contar personajes",
                  "description": "Obtiene el n√∫mero total de personajes en la base de datos",
                  "value": {
                    "query": "query {\n  characterCount\n}"
                  }
                },
                "syncCharacters": {
                  "summary": "üîÑ Sincronizar personajes",
                  "description": "Sincroniza 15 personajes desde la API de Rick & Morty",
                  "value": {
                    "query": "mutation SyncFromAPI {\n  syncCharacters {\n    success\n    message\n    count\n  }\n}"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Respuesta GraphQL exitosa",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GraphQLResponse"
                },
                "examples": {
                  "charactersResponse": {
                    "summary": "Lista de personajes",
                    "value": {
                      "data": {
                        "characters": [
                          {
                            "id": 1,
                            "name": "Rick Sanchez",
                            "status": "Alive",
                            "species": "Human",
                            "gender": "Male",
                            "origin": "Earth (C-137)",
                            "image": "https://rickandmortyapi.com/api/character/avatar/1.jpeg"
                          },
                          {
                            "id": 2,
                            "name": "Morty Smith",
                            "status": "Alive",
                            "species": "Human",
                            "gender": "Male",
                            "origin": "unknown",
                            "image": "https://rickandmortyapi.com/api/character/avatar/2.jpeg"
                          }
                        ]
                      }
                    }
                  },
                  "singleCharacterResponse": {
                    "summary": "Un personaje",
                    "value": {
                      "data": {
                        "character": {
                          "id": 1,
                          "name": "Rick Sanchez",
                          "status": "Alive",
                          "species": "Human",
                          "gender": "Male",
                          "origin": "Earth (C-137)",
                          "image": "https://rickandmortyapi.com/api/character/avatar/1.jpeg"
                        }
                      }
                    }
                  },
                  "syncResponse": {
                    "summary": "Resultado de sincronizaci√≥n",
                    "value": {
                      "data": {
                        "syncCharacters": {
                          "success": true,
                          "message": "Successfully synced 15 characters from Rick & Morty API",
                          "count": 15
                        }
                      }
                    }
                  },
                  "countResponse": {
                    "summary": "Conteo de personajes",
                    "value": {
                      "data": {
                        "characterCount": 15
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error en la query GraphQL",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GraphQLError"
                },
                "example": {
                  "errors": [
                    {
                      "message": "Syntax Error: Expected Name, found \"}\".",
                      "locations": [{ "line": 1, "column": 10 }]
                    }
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "description": "Estado del servidor y sus servicios",
        "required": ["status", "message", "redis", "cron"],
        "properties": {
          "status": {
            "type": "string",
            "enum": ["OK"],
            "description": "Estado general del servidor",
            "example": "OK"
          },
          "message": {
            "type": "string",
            "description": "Mensaje descriptivo del estado",
            "example": "Server is running üöÄ"
          },
          "redis": {
            "type": "string",
            "enum": ["connected", "disconnected"],
            "description": "Estado de conexi√≥n a Redis",
            "example": "connected"
          },
          "cron": {
            "type": "string",
            "enum": ["running", "stopped"],
            "description": "Estado del cron job de sincronizaci√≥n",
            "example": "running"
          }
        }
      },
      "Character": {
        "type": "object",
        "description": "Personaje de Rick & Morty",
        "required": ["id", "name", "status", "species", "gender"],
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID √∫nico del personaje (de la API original)",
            "example": 1
          },
          "name": {
            "type": "string",
            "description": "Nombre completo del personaje",
            "example": "Rick Sanchez"
          },
          "status": {
            "type": "string",
            "enum": ["Alive", "Dead", "unknown"],
            "description": "Estado vital del personaje",
            "example": "Alive"
          },
          "species": {
            "type": "string",
            "description": "Especie del personaje",
            "example": "Human",
            "enum": ["Human", "Alien", "Humanoid", "Robot", "Animal", "Mythological Creature", "Poopybutthole", "Cronenberg", "Disease", "unknown"]
          },
          "type": {
            "type": "string",
            "nullable": true,
            "description": "Subtipo espec√≠fico del personaje",
            "example": "Genetic experiment"
          },
          "gender": {
            "type": "string",
            "enum": ["Male", "Female", "Genderless", "unknown"],
            "description": "G√©nero del personaje",
            "example": "Male"
          },
          "origin": {
            "type": "string",
            "description": "Planeta o dimensi√≥n de origen",
            "example": "Earth (C-137)"
          },
          "image": {
            "type": "string",
            "format": "uri",
            "description": "URL de la imagen del personaje",
            "example": "https://rickandmortyapi.com/api/character/avatar/1.jpeg"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha de creaci√≥n del registro"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Fecha de √∫ltima actualizaci√≥n"
          }
        }
      },
      "CharacterFilterInput": {
        "type": "object",
        "description": "Filtros para b√∫squeda de personajes",
        "properties": {
          "name": {
            "type": "string",
            "description": "B√∫squeda parcial por nombre (case-insensitive)",
            "example": "Rick"
          },
          "status": {
            "type": "string",
            "enum": ["Alive", "Dead", "unknown"],
            "description": "Filtrar por estado vital",
            "example": "Alive"
          },
          "species": {
            "type": "string",
            "description": "Filtrar por especie",
            "example": "Human"
          },
          "gender": {
            "type": "string",
            "enum": ["Male", "Female", "Genderless", "unknown"],
            "description": "Filtrar por g√©nero",
            "example": "Male"
          },
          "origin": {
            "type": "string",
            "description": "Filtrar por origen",
            "example": "Earth (C-137)"
          }
        }
      },
      "SyncResult": {
        "type": "object",
        "description": "Resultado de la operaci√≥n de sincronizaci√≥n",
        "required": ["success", "message"],
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Indica si la sincronizaci√≥n fue exitosa",
            "example": true
          },
          "message": {
            "type": "string",
            "description": "Mensaje descriptivo del resultado",
            "example": "Successfully synced 15 characters from Rick & Morty API"
          },
          "count": {
            "type": "integer",
            "nullable": true,
            "description": "N√∫mero de personajes sincronizados",
            "example": 15
          }
        }
      },
      "GraphQLRequest": {
        "type": "object",
        "description": "Petici√≥n GraphQL",
        "required": ["query"],
        "properties": {
          "query": {
            "type": "string",
            "description": "Query o mutation GraphQL a ejecutar",
            "example": "query { characters { id name status } }"
          },
          "variables": {
            "type": "object",
            "description": "Variables para la query (opcional)",
            "additionalProperties": true,
            "example": {
              "id": 1
            }
          },
          "operationName": {
            "type": "string",
            "description": "Nombre de la operaci√≥n a ejecutar (si hay m√∫ltiples)",
            "example": "GetCharacter"
          }
        }
      },
      "GraphQLResponse": {
        "type": "object",
        "description": "Respuesta GraphQL est√°ndar",
        "properties": {
          "data": {
            "type": "object",
            "description": "Datos retornados por la query",
            "additionalProperties": true
          },
          "errors": {
            "type": "array",
            "description": "Lista de errores (si los hay)",
            "items": {
              "$ref": "#/components/schemas/GraphQLErrorItem"
            }
          }
        }
      },
      "GraphQLError": {
        "type": "object",
        "description": "Respuesta de error GraphQL",
        "properties": {
          "errors": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/GraphQLErrorItem"
            }
          }
        }
      },
      "GraphQLErrorItem": {
        "type": "object",
        "description": "Detalle de un error GraphQL",
        "properties": {
          "message": {
            "type": "string",
            "description": "Mensaje de error",
            "example": "Character with ID 999 not found"
          },
          "locations": {
            "type": "array",
            "description": "Ubicaci√≥n del error en la query",
            "items": {
              "type": "object",
              "properties": {
                "line": {
                  "type": "integer",
                  "example": 1
                },
                "column": {
                  "type": "integer",
                  "example": 10
                }
              }
            }
          },
          "path": {
            "type": "array",
            "description": "Ruta al campo que caus√≥ el error",
            "items": {
              "type": "string"
            },
            "example": ["character"]
          },
          "extensions": {
            "type": "object",
            "description": "Informaci√≥n adicional del error",
            "properties": {
              "code": {
                "type": "string",
                "example": "NOT_FOUND"
              }
            }
          }
        }
      }
    }
  }
}
